{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://company.com/schemas/cloud-agent-delegation/v1.0.0",
  "title": "Cloud Agent Delegation Configuration Schema",
  "description": "Multi-cloud delegation system configuration with intelligent routing, load balancing, and failover capabilities",
  "type": "object",
  "required": [
    "metadata",
    "delegation",
    "providers",
    "routing",
    "monitoring",
    "security"
  ],
  "additionalProperties": false,
  
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Configuration metadata and versioning information",
      "required": ["schema_version", "created_at", "updated_at", "author"],
      "properties": {
        "schema_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$",
          "description": "Schema version number"
        },
        "created_at": {
          "type": "string",
          "format": "date",
          "description": "Configuration creation date"
        },
        "updated_at": {
          "type": "string",
          "format": "date",
          "description": "Last update date"
        },
        "author": {
          "type": "string",
          "minLength": 1,
          "description": "Configuration author"
        },
        "validation": {
          "type": "object",
          "properties": {
            "purpose": {
              "type": "string"
            },
            "required_checks": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "quality": {
          "type": "object",
          "properties": {
            "completeness": {
              "type": "string"
            },
            "consistency": {
              "type": "string"
            },
            "maintainability": {
              "type": "string"
            }
          }
        }
      }
    },
    
    "delegation": {
      "type": "object",
      "description": "Core delegation configuration",
      "required": ["enabled", "mode"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable/disable delegation system"
        },
        "mode": {
          "type": "string",
          "enum": ["load_balancing", "failover", "hybrid"],
          "description": "Delegation mode"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300,
          "description": "Task execution timeout in seconds"
        }
      }
    },
    
    "providers": {
      "type": "object",
      "description": "Cloud provider configurations",
      "required": ["aws", "gcp", "azure"],
      "properties": {
        "aws": {
          "$ref": "#/$defs/providerConfig"
        },
        "gcp": {
          "$ref": "#/$defs/providerConfig"
        },
        "azure": {
          "$ref": "#/$defs/providerConfig"
        }
      }
    },
    
    "routing": {
      "type": "object",
      "description": "Task routing and load balancing configuration",
      "required": ["strategy", "weights", "rules"],
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["round_robin", "weighted_round_robin", "least_connections", "random"],
          "description": "Load balancing strategy"
        },
        "weights": {
          "type": "object",
          "description": "Provider weight distribution",
          "required": ["aws", "gcp", "azure"],
          "properties": {
            "aws": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "gcp": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "azure": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          },
          "additionalProperties": false
        },
        "rules": {
          "type": "array",
          "description": "Task routing rules",
          "items": {
            "$ref": "#/$defs/routingRule"
          }
        }
      }
    },
    
    "monitoring": {
      "type": "object",
      "description": "Monitoring and health check configuration",
      "required": ["enabled", "metrics", "alerts"],
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "provider": {
              "type": "string",
              "enum": ["prometheus", "cloudwatch", "datadog"]
            },
            "endpoint": {
              "type": "string",
              "format": "uri"
            },
            "interval": {
              "type": "integer",
              "minimum": 10,
              "maximum": 300
            }
          }
        },
        "health_checks": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "interval": {
              "type": "integer",
              "minimum": 10
            },
            "timeout": {
              "type": "integer",
              "minimum": 1
            },
            "retries": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5
            }
          }
        },
        "alerts": {
          "type": "object",
          "properties": {
            "channels": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/alertChannel"
              }
            }
          }
        }
      }
    },
    
    "security": {
      "type": "object",
      "description": "Security configuration",
      "required": ["authentication", "authorization"],
      "properties": {
        "authentication": {
          "type": "object",
          "properties": {
            "method": {
              "type": "string",
              "enum": ["oauth2", "api_key", "iam"]
            }
          }
        },
        "authorization": {
          "type": "object",
          "properties": {
            "method": {
              "type": "string",
              "enum": ["rbac", "abac"]
            }
          }
        },
        "encryption": {
          "type": "object",
          "properties": {
            "in_transit": {
              "type": "string",
              "enum": ["tls_1_2", "tls_1_3"]
            },
            "at_rest": {
              "type": "string",
              "enum": ["aes_256_gcm", "aes_256_cbc"]
            }
          }
        },
        "network": {
          "type": "object",
          "properties": {
            "allowed_ips": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}/(\\d|[12]\\d|3[0-2])$"
              }
            }
          }
        }
      }
    },
    
    "failover": {
      "type": "object",
      "description": "Failover and retry configuration",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "retry_delay": {
          "type": "integer",
          "minimum": 1
        },
        "backoff_strategy": {
          "type": "string",
          "enum": ["linear", "exponential", "fibonacci"]
        }
      }
    }
  },
  
  "$defs": {
    "providerConfig": {
      "type": "object",
      "required": ["enabled", "region", "endpoint"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable this provider"
        },
        "region": {
          "type": "string",
          "minLength": 1,
          "description": "Provider region"
        },
        "endpoint": {
          "type": "string",
          "format": "uri",
          "description": "Provider API endpoint"
        },
        "credentials": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["env", "file", "secret_manager"]
            },
            "env_var": {
              "type": "string"
            }
          }
        },
        "limits": {
          "type": "object",
          "properties": {
            "max_concurrent_tasks": {
              "type": "integer",
              "minimum": 1
            },
            "max_retries": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10
            }
          }
        }
      }
    },
    
    "routingRule": {
      "type": "object",
      "required": ["task_type", "preferred_provider"],
      "properties": {
        "task_type": {
          "type": "string",
          "enum": [
            "code_analysis",
            "auto_fix",
            "security_scan",
            "performance_optimization",
            "report_generation"
          ]
        },
        "preferred_provider": {
          "type": "string",
          "enum": ["aws", "gcp", "azure"]
        },
        "fallback_providers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["aws", "gcp", "azure"]
          }
        },
        "conditions": {
          "type": "object",
          "properties": {
            "min_memory_mb": {
              "type": "integer",
              "minimum": 128
            },
            "max_duration_seconds": {
              "type": "integer",
              "minimum": 1
            }
          }
        }
      }
    },
    
    "alertChannel": {
      "type": "object",
      "required": ["type", "enabled"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["slack", "email", "pagerduty", "webhook"]
        },
        "enabled": {
          "type": "boolean"
        },
        "config": {
          "type": "object",
          "properties": {
            "webhook_url": {
              "type": "string",
              "format": "uri"
            },
            "recipients": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "email"
              }
            }
          }
        },
        "severity": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["info", "warning", "error", "critical"]
          }
        }
      }
    }
  }
}
